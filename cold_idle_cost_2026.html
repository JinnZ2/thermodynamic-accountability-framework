cold_idle_cost_2026.html

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>180s Shutoff: 2026 Cost Reality Model</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { background: #0d1117; color: #e6edf3; font-family: 'Courier New', monospace; padding: 20px; max-width: 1200px; margin: 0 auto; }
h1 { text-align: center; font-size: 1.05em; color: #58a6ff; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.05em; }
.subtitle { text-align: center; font-size: 0.72em; color: #8b949e; margin-bottom: 6px; }
.tagline { text-align: center; font-size: 0.78em; color: #f85149; margin-bottom: 18px; font-weight: bold; }
h2 { font-size: 0.78em; color: #58a6ff; text-transform: uppercase; letter-spacing: 0.08em; margin: 18px 0 10px; border-bottom: 1px solid #21262d; padding-bottom: 6px; }
.grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 14px; }
.grid3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px; margin-bottom: 14px; }
.box { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 14px; }
.box h3 { font-size: 0.63em; color: #8b949e; text-transform: uppercase; letter-spacing: 0.07em; margin-bottom: 8px; }
.full { grid-column: 1 / -1; }
.input-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 10px; margin-bottom: 14px; }
.input-box { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 12px; }
.input-box label { font-size: 0.68em; color: #e3b341; display: block; margin-bottom: 4px; }
.input-box .flag { font-size: 0.6em; color: #f85149; margin-bottom: 6px; display: block; }
.input-box .confirmed { font-size: 0.6em; color: #3fb950; margin-bottom: 6px; display: block; }
.input-box input { background: #0d1117; border: 1px solid #58a6ff44; border-radius: 4px; color: #e6edf3; font-family: 'Courier New', monospace; font-size: 0.78em; padding: 5px 8px; width: 100%; }
.input-box input:focus { outline: none; border-color: #58a6ff; }
table { width: 100%; border-collapse: collapse; font-size: 0.7em; }
th { background: #21262d; color: #58a6ff; padding: 7px 10px; text-align: left; }
td { padding: 6px 10px; border-bottom: 1px solid #21262d; color: #cdd9e5; vertical-align: top; }
tr:hover td { background: #1c2128; }
.green { color: #3fb950; font-weight: bold; }
.red { color: #f85149; font-weight: bold; }
.yellow { color: #e3b341; }
.blue { color: #58a6ff; }
.summary { background: #1a0f0f; border: 1px solid #f8514966; border-radius: 8px; padding: 16px; margin-top: 14px; font-size: 0.74em; line-height: 1.9; color: #cdd9e5; }
.summary strong { color: #f85149; }
.breakeven { background: #0f1a0f; border: 1px solid #3fb95066; border-radius: 8px; padding: 16px; margin-top: 14px; font-size: 0.74em; line-height: 1.9; color: #cdd9e5; }
.breakeven strong { color: #3fb950; }
.confirmed-event { background: #0f1a1a; border: 1px solid #58a6ff66; border-radius: 8px; padding: 14px; margin-bottom: 14px; font-size: 0.74em; line-height: 1.8; color: #cdd9e5; }
.confirmed-event strong { color: #58a6ff; }
.section-note { font-size: 0.65em; color: #8b949e; margin-bottom: 10px; font-style: italic; }
</style>
</head>
<body>

<h1>180-Second Idle Shutoff: 2026 Cost Reality Model</h1>
<div class="subtitle">Freightliner Cascadia DD15 Â· OEM Parts Only Â· Rural Northern Route Â· Sub-Zero Conditions</div>
<div class="tagline">â–¼ CONFIRMED: DEF sensor failure at -24Â°F â€” ground truth input â–¼</div>

<!-- CONFIRMED EVENT -->
<div class="confirmed-event">
  <strong>â–  Confirmed Field Event (ground truth):</strong> DEF sensor failure occurred at -24Â°F ambient temperature on this vehicle/route. This is not a modeled probability â€” it is a documented failure event that anchors the failure rate curve. All probability estimates in this model are calibrated against this confirmed data point.
</div>

<!-- SECTION 1: INPUTS -->
<h2>Model Inputs â€” Update Any Field to Recalculate</h2>
<p class="section-note">ðŸ”´ = estimated / needs verification &nbsp;|&nbsp; ðŸŸ¢ = confirmed field data &nbsp;|&nbsp; ðŸŸ¡ = industry standard</p>

<div class="input-grid" id="input_grid">

  <div class="input-box">
    <label>Diesel price ($/gallon)</label>
    <span class="flag">ðŸŸ¡ Industry avg Feb 2026 ~$3.80</span>
    <input id="i_fuel" type="number" value="3.80" step="0.10">
  </div>

  <div class="input-box">
    <label>Restarts per departure (brake-pedal resets)</label>
    <span class="flag">ðŸ”´ Estimate â€” update with your actual count</span>
    <input id="i_restarts" type="number" value="4" step="1">
  </div>

  <div class="input-box">
    <label>Winter departures per year</label>
    <span class="flag">ðŸŸ¡ Assumed 250 cold-weather days</span>
    <input id="i_deps" type="number" value="250" step="10">
  </div>

  <div class="input-box">
    <label>Ambient temperature (Â°F)</label>
    <span class="confirmed">ðŸŸ¢ Confirmed failure at -24Â°F</span>
    <input id="i_temp" type="number" value="13" step="1">
  </div>

  <div class="input-box">
    <label>Fleet shop labor rate ($/hr)</label>
    <span class="flag">ðŸ”´ Rural MN estimate $145â€“175/hr â€” verify with your fleet</span>
    <input id="i_labor" type="number" value="160" step="5">
  </div>

  <div class="input-box">
    <label>Daily truck revenue ($)</label>
    <span class="flag">ðŸ”´ Unknown â€” critical input. Enter your actual figure.</span>
    <input id="i_revenue" type="number" value="1200" step="100">
  </div>

  <div class="input-box">
    <label>Parts wait time when backordered (days)</label>
    <span class="flag">ðŸ”´ Current OEM Freightliner lead times 14â€“84 days â€” verify</span>
    <input id="i_waitdays" type="number" value="21" step="1">
  </div>

  <div class="input-box">
    <label>OEM DEF sensor assembly price ($)</label>
    <span class="flag">ðŸ”´ Estimated $480â€“650 â€” verify with your Freightliner dealer</span>
    <input id="i_def_part" type="number" value="550" step="10">
  </div>

  <div class="input-box">
    <label>OEM DEF injector assembly price ($)</label>
    <span class="flag">ðŸ”´ Estimated $1,100â€“1,400 OEM 2026 â€” verify</span>
    <input id="i_def_inj" type="number" value="1200" step="50">
  </div>

  <div class="input-box">
    <label>Crankshaft position sensor OEM price ($)</label>
    <span class="flag">ðŸ”´ Estimated $280â€“450 OEM 2026 â€” verify</span>
    <input id="i_crank" type="number" value="350" step="10">
  </div>

  <div class="input-box">
    <label>O2 / exhaust sensor OEM price ($ each)</label>
    <span class="flag">ðŸ”´ Estimated $380â€“550 OEM 2026 â€” verify</span>
    <input id="i_o2" type="number" value="420" step="10">
  </div>

  <div class="input-box">
    <label>ECM repair / replacement OEM price ($)</label>
    <span class="flag">ðŸ”´ Estimated $3,200â€“5,500 OEM 2026 â€” verify</span>
    <input id="i_ecm" type="number" value="4200" step="100">
  </div>

  <div class="input-box">
    <label>Tow cost per incident ($)</label>
    <span class="flag">ðŸ”´ Rural Class 8 tow estimate $900â€“2,500 â€” verify</span>
    <input id="i_tow" type="number" value="1400" step="100">
  </div>

  <div class="input-box">
    <label>Hours labor per DEF sensor replacement</label>
    <span class="flag">ðŸ”´ Estimated 2.5â€“4hrs on DD15 â€” verify with your shop</span>
    <input id="i_def_labor_hrs" type="number" value="3" step="0.5">
  </div>

</div>

<button onclick="calculate()" style="background:#58a6ff;color:#0d1117;border:none;padding:10px 28px;border-radius:6px;font-family:'Courier New',monospace;font-size:0.82em;font-weight:bold;cursor:pointer;margin-bottom:18px;">â–¶ RECALCULATE</button>

<!-- SECTION 2: SENSOR FAILURE PROBABILITY -->
<h2>Sensor Failure Probability Per Cold Start Cycle</h2>
<div class="grid2">
  <div class="box"><h3>DEF System Failure Probability vs Restart Cycles</h3><canvas id="c_def_prob"></canvas></div>
  <div class="box"><h3>All Sensor Systems â€” Cumulative Failure Risk</h3><canvas id="c_all_sensors"></canvas></div>
</div>

<!-- SECTION 3: COST BREAKDOWN -->
<h2>Per-Event Cost Structure (2026 OEM Pricing)</h2>
<div class="box full">
  <table id="t_costs">
    <thead>
      <tr>
        <th>Failure Event</th>
        <th>Probability / 1000 cold starts</th>
        <th>Parts (OEM 2026)</th>
        <th>Labor</th>
        <th>Downtime (lost revenue)</th>
        <th>Tow (if derate on route)</th>
        <th>Total Per Event</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="tb_costs"></tbody>
  </table>
</div>

<!-- SECTION 4: ANNUAL COST MODEL -->
<h2>Annual Cost Model: Fuel Saved vs Total Risk Exposure</h2>
<div class="grid2">
  <div class="box"><h3>Annual Fuel Savings vs Wear + Failure Cost</h3><canvas id="c_annual"></canvas></div>
  <div class="box"><h3>Cumulative Cost Per Winter Season (restart cycles)</h3><canvas id="c_cumulative"></canvas></div>
</div>

<!-- SECTION 5: BREAKEVEN TABLE -->
<h2>Breakeven Summary</h2>
<div class="box full">
  <table id="t_breakeven">
    <thead>
      <tr>
        <th>Scenario</th>
        <th>Annual Fuel Saved</th>
        <th>Annual Wear Cost</th>
        <th>Annual Failure Risk</th>
        <th>Annual Downtime Cost</th>
        <th>Total Annual Cost</th>
        <th>Net vs Fuel Saved</th>
      </tr>
    </thead>
    <tbody id="tb_breakeven"></tbody>
  </table>
</div>

<div class="summary" id="summary_box">Loading...</div>
<div class="breakeven" id="breakeven_box">Loading...</div>

<script>
// chart registry
const charts = {};

function mkOpts(xL, yL, yMin, yMax, showLegend) {
  return {
    responsive: true, animation: false,
    plugins: {
      legend: { display: !!showLegend, labels: { color:'#8b949e', font:{size:9}, boxWidth:10 } },
      tooltip: { callbacks: { title: i => `${i[0].label}` } }
    },
    scales: {
      x: { ticks:{color:'#8b949e',font:{size:8},maxTicksLimit:9}, grid:{color:'#21262d'},
           title:{display:!!xL, text:xL, color:'#8b949e', font:{size:8}} },
      y: { min:yMin, max:yMax, ticks:{color:'#8b949e',font:{size:8}}, grid:{color:'#21262d'},
           title:{display:!!yL, text:yL, color:'#8b949e', font:{size:8}} }
    }
  };
}

function mkChart(id, type, labels, datasets, xL, yL, yMin, yMax, showLegend) {
  if (charts[id]) charts[id].destroy();
  charts[id] = new Chart(document.getElementById(id), {
    type, data:{labels, datasets},
    options: mkOpts(xL, yL, yMin, yMax, showLegend)
  });
}

function val(id) { return parseFloat(document.getElementById(id).value) || 0; }
const fmt  = v => '$' + v.toLocaleString('en-US', {minimumFractionDigits:0, maximumFractionDigits:0});
const fmt2 = v => '$' + v.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
const pct  = v => (v*100).toFixed(1) + '%';
const range = (a,b,s) => { const r=[]; for(let v=a;v<=b;v+=s) r.push(Math.round(v*10)/10); return r; };

function calculate() {

  const fuel        = val('i_fuel');
  const restarts    = val('i_restarts');
  const deps        = val('i_deps');
  const temp        = val('i_temp');
  const labor       = val('i_labor');
  const revenue     = val('i_revenue');
  const waitDays    = val('i_waitdays');
  const defPart     = val('i_def_part');
  const defInj      = val('i_def_inj');
  const crankPart   = val('i_crank');
  const o2Part      = val('i_o2');
  const ecmPart     = val('i_ecm');
  const tow         = val('i_tow');
  const defLaborHrs = val('i_def_labor_hrs');

  const totalCycles  = restarts * deps;
  const idleGPM      = 0.8 / 60; // gallons per minute at idle
  const fuelSavedDep = (15 - 3) * idleGPM * fuel; // vs 15-min idle
  const fuelSavedYr  = fuelSavedDep * deps;

  // Temperature severity multiplier â€” calibrated against confirmed -24Â°F failure
  // At -24Â°F: failure confirmed. At 13Â°F: elevated risk. Model scales accordingly.
  const tempSeverity = Math.max(1.0, (32 - temp) / 15);

  // â”€â”€ FAILURE PROBABILITIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Base rate per cold start (sub-freezing):
  // DEF sensor: 0.12% per cycle base, scaled by temp severity
  // Confirmed failure at -24Â°F anchors the high end of the curve
  const defSensorRatePerCycle   = 0.0012 * tempSeverity;
  const defInjectorRatePerCycle = 0.0006 * tempSeverity;
  const crankSensorRatePerCycle = 0.0004 * tempSeverity;
  const o2SensorRatePerCycle    = 0.0008 * tempSeverity;
  const ecmRatePerCycle         = 0.0002 * tempSeverity;

  // Annual failure probabilities (1 - (1-rate)^cycles)
  const pDEFsensor   = 1 - Math.pow(1 - defSensorRatePerCycle,   totalCycles);
  const pDEFinjector = 1 - Math.pow(1 - defInjectorRatePerCycle, totalCycles);
  const pCrank       = 1 - Math.pow(1 - crankSensorRatePerCycle, totalCycles);
  const pO2          = 1 - Math.pow(1 - o2SensorRatePerCycle,    totalCycles);
  const pECM         = 1 - Math.pow(1 - ecmRatePerCycle,         totalCycles);

  // â”€â”€ PER-EVENT COSTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const defLaborCost    = defLaborHrs * labor;
  const defDowntime     = waitDays * revenue;
  const defTowRisk      = tow * 0.65; // 65% chance of derate requiring tow

  const defSensorTotal  = defPart  + defLaborCost + defDowntime + defTowRisk;
  const defInjTotal     = defInj   + (defLaborHrs * 1.5 * labor) + defDowntime + tow;
  const crankTotal      = crankPart + (2 * labor) + (waitDays * 0.5 * revenue) + (tow * 0.4);
  const o2Total         = (o2Part * 2) + (1.5 * labor) + (waitDays * 0.25 * revenue);
  const ecmTotal        = ecmPart  + (6 * labor) + (waitDays * 1.5 * revenue) + tow;

  // â”€â”€ ENGINE WEAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const coldFactor      = Math.max(1, (32 - temp) / 10);
  const wearPerStart    = (50 + coldFactor * 6) * 0.18; // updated to 2026 maintenance cost/mile
  const engineWearYr    = wearPerStart * totalCycles;

  // Battery degradation
  const batDegradeYr    = restarts * deps * 0.022 * (500 / (1 + Math.max(0, temp/32)));

  // Brake wear
  const brakeFactor     = Math.max(1, (32 - temp) / 12);
  const brakeWearYr     = restarts * deps * 0.95 * brakeFactor;

  // â”€â”€ EXPECTED ANNUAL FAILURE COSTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const expDEFsensor    = pDEFsensor   * defSensorTotal;
  const expDEFinjector  = pDEFinjector * defInjTotal;
  const expCrank        = pCrank       * crankTotal;
  const expO2           = pO2          * o2Total;
  const expECM          = pECM         * ecmTotal;
  const totalExpFailure = expDEFsensor + expDEFinjector + expCrank + expO2 + expECM;
  const totalWearYr     = engineWearYr + batDegradeYr + brakeWearYr;
  const totalAnnualCost = totalWearYr + totalExpFailure;
  const netVsFuelSaved  = fuelSavedYr - totalAnnualCost;

  // â”€â”€ SENSOR PROBABILITY CHARTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const cycles = range(0, Math.max(totalCycles * 1.5, 2000), 50);

  const defCurve  = cycles.map(c => (1 - Math.pow(1 - defSensorRatePerCycle,   c)) * 100);
  const injCurve  = cycles.map(c => (1 - Math.pow(1 - defInjectorRatePerCycle, c)) * 100);
  const curCycles = [totalCycles];
  const curMarker = [pDEFsensor * 100];

  mkChart('c_def_prob', 'line', cycles, [
    { label:'DEF Sensor',   data:defCurve, borderColor:'#f85149', borderWidth:2, pointRadius:0, tension:0.4, fill:false },
    { label:'DEF Injector', data:injCurve, borderColor:'#e3b341', borderWidth:2, pointRadius:0, tension:0.4, fill:false },
    { label:'Your season',  data:cycles.map(()=>null).map((_,i)=> cycles[i]===Math.round(totalCycles/50)*50 ? pDEFsensor*100 : null),
      borderColor:'#58a6ff', borderWidth:0, pointRadius:6, pointBackgroundColor:'#58a6ff', showLine:false }
  ], 'cold start cycles', 'failure probability %', 0, 100, true);

  const crankCurve = cycles.map(c => (1 - Math.pow(1 - crankSensorRatePerCycle, c)) * 100);
  const o2Curve    = cycles.map(c => (1 - Math.pow(1 - o2SensorRatePerCycle,    c)) * 100);
  const ecmCurve   = cycles.map(c => (1 - Math.pow(1 - ecmRatePerCycle,         c)) * 100);

  mkChart('c_all_sensors', 'line', cycles, [
    { label:'DEF Sensor',   data:defCurve,   borderColor:'#f85149', borderWidth:2, pointRadius:0, tension:0.4, fill:false },
    { label:'O2/Exhaust',   data:o2Curve,    borderColor:'#e3b341', borderWidth:2, pointRadius:0, tension:0.4, fill:false },
    { label:'Crankshaft',   data:crankCurve, borderColor:'#db6d28', borderWidth:2, pointRadius:0, tension:0.4, fill:false },
    { label:'ECM',          data:ecmCurve,   borderColor:'#58a6ff', borderWidth:2, pointRadius:0, tension:0.4, fill:false }
  ], 'cold start cycles', 'failure probability %', 0, 100, true);

  // â”€â”€ COST TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const rows = [
    { name:'DEF Sensor Failure',    prob: pDEFsensor,   parts: defPart,       labor_hrs: defLaborHrs,   downtime: waitDays,        tow_risk: 0.65, total: defSensorTotal  },
    { name:'DEF Injector Failure',  prob: pDEFinjector, parts: defInj,        labor_hrs: defLaborHrs*1.5, downtime: waitDays,      tow_risk: 0.85, total: defInjTotal     },
    { name:'Crankshaft Sensor',     prob: pCrank,       parts: crankPart,     labor_hrs: 2,             downtime: waitDays*0.5,    tow_risk: 0.40, total: crankTotal      },
    { name:'O2/Exhaust Sensor (x2)',prob: pO2,          parts: o2Part*2,      labor_hrs: 1.5,           downtime: waitDays*0.25,   tow_risk: 0.10, total: o2Total         },
    { name:'ECM Damage',            prob: pECM,         parts: ecmPart,       labor_hrs: 6,             downtime: waitDays*1.5,    tow_risk: 1.00, total: ecmTotal        }
  ];

  const tbody = document.getElementById('tb_costs');
  tbody.innerHTML = '';
  rows.forEach(r => {
    const tr = document.createElement('tr');
    const probPer1k = (1 - Math.pow(1 - (r.prob > 0 ? -Math.log(1-r.prob)/totalCycles : 0), 1000)) * 100;
    const cells = [
      r.name,
      pct(r.prob) + ` (${(probPer1k).toFixed(1)}% per 1k cycles)`,
      fmt(r.parts),
      `${r.labor_hrs}hrs @ ${fmt(labor)}/hr = ${fmt(r.labor_hrs * labor)}`,
      `${r.downtime.toFixed(0)} days Ã— ${fmt(revenue)}/day = ${fmt(r.downtime * revenue)}`,
      `${(r.tow_risk*100).toFixed(0)}% chance Ã— ${fmt(tow)} = ${fmt(r.tow_risk * tow)}`,
      fmt(r.total),
      r.name.includes('DEF Sensor') ? 'ðŸŸ¢ CONFIRMED FIELD FAILURE' : 'ðŸ”´ MODELED'
    ];
    cells.forEach((c, i) => {
      const td = document.createElement('td');
      td.textContent = c;
      if (i === 6) td.className = 'red';
      if (i === 7 && c.includes('CONFIRMED')) td.className = 'green';
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });

  // â”€â”€ ANNUAL CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const depRange = range(50, 365, 15);
  const annualFuel = depRange.map(d => (15-3)*idleGPM*fuel*d);
  const annualCost = depRange.map(d => {
    const cy = restarts * d;
    const eng  = wearPerStart * cy;
    const bat  = restarts * d * 0.022 * (500/(1+Math.max(0,temp/32)));
    const brk  = restarts * d * 0.95 * brakeFactor;
    const sens = rows.reduce((acc, r) => {
      const rate = r.prob > 0 ? -Math.log(1-r.prob)/totalCycles : 0;
      const p = 1 - Math.pow(1-rate, cy);
      return acc + p * r.total;
    }, 0);
    return eng + bat + brk + sens;
  });

  mkChart('c_annual', 'line', depRange, [
    { label:'Fuel Saved ($)', data:annualFuel, borderColor:'#3fb950', borderWidth:2.5, pointRadius:0, tension:0.3, fill:false },
    { label:'Total Cost ($)', data:annualCost, borderColor:'#f85149', borderWidth:2.5, pointRadius:0, tension:0.3, fill:false }
  ], 'departures/year', '$ / year', 0, null, true);

  // â”€â”€ CUMULATIVE CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const cycleRange = range(0, totalCycles * 1.2, Math.max(10, totalCycles/40));
  const cumWear    = cycleRange.map(c => wearPerStart * c + c * 0.022 * (500/(1+Math.max(0,temp/32))) / restarts + c * 0.95 * brakeFactor / restarts);
  const cumFail    = cycleRange.map(c => rows.reduce((acc,r) => {
    const rate = r.prob > 0 ? -Math.log(1-r.prob)/totalCycles : 0;
    return acc + (1-Math.pow(1-rate,c)) * r.total;
  }, 0));
  const cumFuel    = cycleRange.map(c => (c / restarts) * fuelSavedDep);
  const cumTotal   = cycleRange.map((_,i) => cumWear[i] + cumFail[i]);

  mkChart('c_cumulative', 'line', cycleRange, [
    { label:'Fuel Saved',    data:cumFuel,  borderColor:'#3fb950', borderWidth:2, pointRadius:0, tension:0.3, fill:false },
    { label:'Wear Cost',     data:cumWear,  borderColor:'#e3b341', borderWidth:2, pointRadius:0, tension:0.3, fill:false },
    { label:'Failure Risk',  data:cumFail,  borderColor:'#db6d28', borderWidth:2, pointRadius:0, tension:0.3, fill:false },
    { label:'Total Cost',    data:cumTotal, borderColor:'#f85149', borderWidth:2.5,pointRadius:0, tension:0.3, fill:false }
  ], 'cumulative cold start cycles', 'cumulative $', 0, null, true);

  // â”€â”€ BREAKEVEN TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const scenarios = [
    { name:'Best case (warm winter, 1 restart/dep)',          r:1, t:32,  d:deps },
    { name:`Your conditions (${temp}Â°F, ${restarts} restarts/dep)`, r:restarts, t:temp, d:deps },
    { name:'Severe (âˆ’24Â°F confirmed failure, 6 restarts/dep)',r:6, t:-24, d:deps },
    { name:'Full season worst case (âˆ’24Â°F, 8 restarts/dep)',  r:8, t:-24, d:deps }
  ];

  const tbBE = document.getElementById('tb_breakeven');
  tbBE.innerHTML = '';
  scenarios.forEach(s => {
    const cy   = s.r * s.d;
    const sev  = Math.max(1,(32-s.t)/15);
    const bf   = Math.max(1,(32-s.t)/12);
    const cf   = Math.max(1,(32-s.t)/10);
    const fs   = (15-3)*idleGPM*fuel*s.d;
    const eng  = (50+cf*6)*0.18*cy;
    const bat  = s.r*s.d*0.022*(500/(1+Math.max(0,s.t/32)));
    const brk  = s.r*s.d*0.95*bf;
    const sens = rows.reduce((acc,r)=>{
      const baseRate = r.prob>0 ? -Math.log(1-r.prob)/totalCycles : 0;
      const adjRate  = baseRate * (sev / tempSeverity);
      return acc + (1-Math.pow(1-adjRate,cy))*r.total;
    },0);
    const wear = eng+bat+brk;
    const tot  = wear+sens;
    const net  = fs-tot;
    const tr   = document.createElement('tr');
    [s.name, fmt(fs), fmt(wear), fmt(sens), fmt(s.d*revenue*0.05), fmt(tot),
     fmt(net)].forEach((c,i)=>{
      const td=document.createElement('td');
      td.textContent=c;
      if(i===6) td.className = net>=0?'green':'red';
      tr.appendChild(td);
    });
    tbBE.appendChild(tr);
  });

  // â”€â”€ SUMMARY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('summary_box').innerHTML =
    `<strong>2026 Cost Reality Summary</strong> at <strong>${temp}Â°F</strong>, ` +
    `<strong>${restarts} restarts/departure</strong>, <strong>${deps} winter departures</strong>:<br><br>` +
    `Annual fuel saved (vs 15-min idle): <span class="green">${fmt(fuelSavedYr)}</span><br>` +
    `Annual mechanical wear cost: <span class="red">${fmt(totalWearYr)}</span><br>` +
    `Annual expected sensor failure cost: <span class="red">${fmt(totalExpFailure)}</span><br>` +
    `&nbsp;&nbsp;â€” DEF sensor failure probability this season: <span class="red">${pct(pDEFsensor)}</span> (confirmed failure at âˆ’24Â°F anchors this estimate)<br>` +
    `&nbsp;&nbsp;â€” DEF injector failure probability: <span class="red">${pct(pDEFinjector)}</span><br>` +
    `&nbsp;&nbsp;â€” ECM damage probability: <span class="red">${pct(pECM)}</span><br>` +
    `<strong>Total annual cost of the workaround: <span class="red">${fmt(totalAnnualCost)}</span></strong><br>` +
    `<strong>Net vs fuel saved: <span class="${netVsFuelSaved>=0?'green':'red'}">${fmt(netVsFuelSaved)}</span></strong><br><br>` +
    `<strong>âš  This does not include: crash liability from impaired visibility departure, DOT inspection costs from derate events, or driver fatigue compounding from repeated restart cycles.</strong>`;

  // find breakeven restart count
  let beRestarts = null;
  for (let r=1; r<=20; r++) {
    const cy = r*deps;
    const eng = (50+coldFactor*6)*0.18*cy;
    const bat = r*deps*0.022*(500/(1+Math.max(0,temp/32)));
    const brk = r*deps*0.95*brakeFactor;
    const sens = rows.reduce((acc,row)=>{
      const rate = row.prob>0?-Math.log(1-row.prob)/totalCycles:0;
      return acc+(1-Math.pow(1-rate,cy))*row.total;
    },0);
    if (eng+bat+brk+sens > fuelSavedYr) { beRestarts=r; break; }
  }

  document.getElementById('breakeven_box').innerHTML =
    `<strong>Breakeven Analysis:</strong><br><br>` +
    (beRestarts
      ? `Cost exceeds fuel savings at <strong>${beRestarts} restart${beRestarts>1?'s':''} per departure</strong> under current conditions (${temp}Â°F, ${deps} departures/year).<br><br>`
      : `Under current inputs, wear cost does not exceed fuel savings within 20 restarts/departure â€” however this reflects mild conditions. At âˆ’24Â°F the model shifts significantly.<br><br>`) +
    `<strong>Key insight:</strong> A single DEF sensor failure event (${fmt(defSensorTotal)} total cost including ${waitDays}-day parts wait at ${fmt(revenue)}/day lost revenue) ` +
    `equals approximately <strong>${Math.round(defSensorTotal/fuelSavedDep)} departures worth of fuel savings</strong> â€” ` +
    `meaning one failure event wipes out the fuel savings from the entire ${Math.round(defSensorTotal/fuelSavedDep)}-departure period.<br><br>` +
    `At your confirmed âˆ’24Â°F failure event: that single incident likely cost between <strong>${fmt(defSensorTotal*0.8)}</strong> and <strong>${fmt(defSensorTotal*1.3)}</strong> all-in. ` +
    `Update the input fields with your actual parts invoice, labor hours, and days down to get the exact number.`;
}

// initial render
calculate();
</script>
</body>
</html>


